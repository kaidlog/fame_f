(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{256:function(t,e,n){},257:function(t,e,n){},258:function(t,e,n){},259:function(t,e,n){},260:function(t,e,n){},275:function(t,e,n){"use strict";n(256)},276:function(t,e,n){"use strict";n(257)},277:function(t,e,n){"use strict";n(258)},278:function(t,e,n){"use strict";n(259)},279:function(t,e,n){"use strict";n(260)},283:function(t,e,n){"use strict";n.r(e);var r=n(266),o=n.n(r),c=n(3),m=(n(39),n(272),n(14),n(72),n(73),n(18),n(71),n(53),n(40),n(95),"写下你的评论,支持markdown语法哟..."),l={props:{articleId:{type:[String,Number],required:!0}},data:function(){return{commentAgrees:[],commentDisagrees:[],commentContent:"",user:{name:"",email:"",website:"",gravatar:""},isEdit:!1,isComment:!1,isReply:!1,replyComment:{id:-1,name:"",content:""},placeHolder:m}},computed:{comments:function(){return this.$store.state.comment.pagination.list},total:function(){return this.$store.state.comment.pagination.total}},mounted:function(){this.loadComments(),this.init(),this.commentPasteListen()},methods:{toSomeAnchorById:function(t){this.$util.goAnchor(t,120,60)},gravatar:function(t){return this.$gravarar.url(t,{s:"36",d:"retro"})},updateUserGravatar:function(){this.user.email&&(this.user.gravatar=this.gravatar(this.user.email))},commentPasteListen:function(){document.addEventListener("copy",(function(t){if(window.getSelection){var content=window.getSelection().toString();t.clipboardData.setData("text/plain",content),t.preventDefault()}}))},commentClickListen:function(){this.isEdit=!0,this.placeHolder=""},commentBlurListen:function(){this.isEdit=!1,this.commentContent&&""!==this.commentContent||(this.placeHolder=m)},commentEditListen:function(t){this.isEdit=!0,this.commentContent=this.$refs.content.textContent,""!==this.commentContent&&(this.placeHolder="")},closeReply:function(){this.isReply=!1,this.replyComment.id=-1,this.replyComment.content="",this.replyComment.name=""},replyFor:function(t,e,content){this.isReply=!0,this.replyComment.id=t,this.replyComment.content=content,this.replyComment.name=e,this.toSomeAnchorById("reply")},clearComment:function(){this.commentContent="",this.isEdit=!1,this.isComment=!1,this.isReply=!1,this.replyComment={id:-1,name:"",content:""},this.$refs.content.innerHTML="",this.placeHolder=m},alreadyAgree:function(t){return this.commentAgrees.includes(t)},alreadyDisagree:function(t){return this.commentDisagrees.includes(t)},assessComment:function(t,e){var n=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("COMMENT_AGREE"!==e){r.next=3;break}if(!n.alreadyAgree(t)){r.next=3;break}return r.abrupt("return");case 3:if("disagree"!==e){r.next=6;break}if(!n.alreadyDisagree(t)){r.next=6;break}return r.abrupt("return");case 6:if(o=null,"agree"!==e){r.next=11;break}return r.next=10,n.$store.dispatch("agreeComment",t);case 10:o=r.sent;case 11:if("disagree"!==e){r.next=15;break}return r.next=14,n.$store.dispatch("disagreeComment",t);case 14:o=r.sent;case 15:o&&o.success?localStorage&&("agree"===e?(n.commentAgrees.push(t),localStorage.setItem("COMMENT_AGREE",JSON.stringify(n.commentAgrees))):"disagree"===e&&(n.commentDisagrees.push(t),localStorage.setItem("COMMENT_DISAGREE",JSON.stringify(n.commentDisagrees)))):("agree"===e&&alert("赞评论失败"),"disagree"===e&&alert("踩评论失败"));case 16:case"end":return r.stop()}}),r)})))()},submitComment:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function n(){var html,r,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.preventDefault(),e.isComment&&alert("请等待发布完成"),(html=e.commentContent)&&""!==html){n.next=5;break}return n.abrupt("return",alert("请填写回复内容"));case 5:if(html=(html=(html=html.replace(/<div>/g,"\n")).replace(/<\/div>/g,"")).replace(/&nbsp;/g," "),r=e.commentContent.split("\n").length>36,o=e.commentContent.length>1e3,!r&&!o){n.next=12;break}return n.abrupt("return",alert("请回复内容不超过1000字/36行"));case 12:return e.isComment=!0,n.next=15,e.$store.dispatch("submitComment",{articleId:e.articleId,replyCommentId:e.replyComment.id,content:html,name:e.user.name,email:e.user.email,website:e.user.website});case 15:c=n.sent,e.isComment=!1,c.success?(e.loadComments(),e.clearComment(),e.init()):alert(c.msg);case 18:case"end":return n.stop()}}),n)})))()},loadComments:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("getComments",{articleId:t.articleId,page:0,limit:999});case 2:case"end":return e.stop()}}),e)})))()},init:function(){if(localStorage){var t=localStorage.getItem("COMMENT_AGREE"),e=localStorage.getItem("COMMENT_DISAGREE");t&&(this.commentAgrees=JSON.parse(t)),e&&(this.commentDisagrees=JSON.parse(e))}}}},d=(n(275),n(276),n(11)),v=Object(d.a)(l,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment",attrs:{id:"comment"}},[n("transition-group",{attrs:{name:"list",tag:"span"}},[n("div",{key:1,staticClass:"comment-header"},[n("span",{staticClass:"total"},[t._v(t._s(t.total)+"条评论")]),t._v(" "),n("span",{staticClass:"line"})]),t._v(" "),n("div",{key:2,staticClass:"comment-box"},[n("form",{on:{submit:t.submitComment}},[n("div",{staticClass:"comment-edit"},[n("div",{staticClass:"gravatar gravatar-comment"},[n("img",{attrs:{src:t.user.gravatar||"/avator.jpg",alt:"avatar"}})]),t._v(" "),n("div",{staticClass:"editor"},[n("transition-group",{attrs:{id:"reply",tag:"div",name:"list"}},[t.isReply?n("div",{key:1,staticClass:"reply"},[n("div",{staticClass:"reply-name"},[n("span",[t._v("回复:"+t._s(t.replyComment.name))]),t._v(" "),n("a",{on:{click:t.closeReply}},[n("span",{staticClass:"icon-close"})])]),t._v(" "),n("div",{directives:[{name:"prism",rawName:"v-prism"}],staticClass:"reply-preview markdown-body",domProps:{innerHTML:t._s(t.replyComment.content)}})]):t._e(),t._v(" "),n("div",{key:2,staticClass:"markdown"},[n("div",{ref:"content",staticClass:"markdown-editor",class:{editing:t.isEdit},attrs:{contenteditable:"true",placeholder:t.placeHolder},on:{keyup:function(e){return t.commentEditListen(e)},blur:t.commentBlurListen,click:t.commentClickListen}})])])],1)]),t._v(" "),n("div",{staticClass:"comment-user"},[n("div",{staticClass:"user-input"},[n("div",{staticClass:"name"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.user.name,expression:"user.name"}],attrs:{required:"required",type:"text",name:"name",placeholder:"称呼（必填）",maxlength:"10"},domProps:{value:t.user.name},on:{input:function(e){e.target.composing||t.$set(t.user,"name",e.target.value)}}})]),t._v(" "),n("div",{staticClass:"email"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],attrs:{type:"email",name:"email",placeholder:"邮箱（非必填，不会公开）",maxlength:"50"},domProps:{value:t.user.email},on:{blur:t.updateUserGravatar,input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})]),t._v(" "),n("div",{staticClass:"website"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.user.website,expression:"user.website"}],attrs:{type:"url",name:"url",placeholder:"网站（http, https:// 开头，非必填）",maxlength:"50"},domProps:{value:t.user.website},on:{input:function(e){e.target.composing||t.$set(t.user,"website",e.target.value)}}})])]),t._v(" "),n("button",{staticClass:"submit",attrs:{type:"submit",disabled:t.isComment}},[n("span",[t._v(t._s(t.isComment?"发布中...":"发布"))]),n("i",{staticClass:"icon-rocket"})])])])]),t._v(" "),n("div",{key:3,staticClass:"comment-body"},[n("transition-group",{staticClass:"comment-list",attrs:{name:"list",tag:"ul"}},t._l(t.comments,(function(e){return n("li",{key:e.id,staticClass:"comment-item"},[n("div",{staticClass:"gravatar"},[n("img",{attrs:{src:t.gravatar(e.email),alt:"avatar"}})]),t._v(" "),n("div",{staticClass:"comment-item-body"},[n("div",{staticClass:"comment-item-header"},[n("a",{staticClass:"user-name"},[t._v(t._s(e.name))]),t._v(" "),n("span",{staticClass:"comment-date"},[t._v(t._s(t._f("time")(e.created,"yyyy.MM.dd hh:mm")))])]),t._v(" "),n("div",{directives:[{name:"prism",rawName:"v-prism"}],staticClass:"comment-item-content markdown-body"},[-1!==e.parentId&&e.parentComment?n("div",{staticClass:"comment-item-reply-box"},[n("a",{staticClass:"user-name"},[t._v(t._s(e.parentComment.name))]),t._v(" "),n("div",{staticClass:"comment-item-replay-content",domProps:{innerHTML:t._s(e.parentComment.content)}})]):t._e(),t._v(" "),n("div",{domProps:{innerHTML:t._s(e.content)}})]),t._v(" "),n("div",{staticClass:"comment-item-footer"},[n("a",{staticClass:"comment-item-agree",class:{active:t.alreadyAgree(e.id)},on:{click:function(n){return t.assessComment(e.id,"agree")}}},[n("span",{staticClass:"icon-thumbs-o-up"}),n("span",[t._v("顶("+t._s(e.agree)+")")])]),t._v(" "),n("a",{staticClass:"comment-item-disagree",class:{active:t.alreadyDisagree(e.id)},on:{click:function(n){return t.assessComment(e.id,"disagree")}}},[n("span",{staticClass:"icon-thumbs-o-down"}),n("span",[t._v("踩("+t._s(e.disagree)+")")])]),t._v(" "),n("a",{staticClass:"comment-item-reply",on:{click:function(n){return t.replyFor(e.id,e.name,e.content)}}},[n("span",{staticClass:"icon-reply"}),n("span",[t._v("回复")])])])])])})),0)],1)])],1)}),[],!1,null,"3a611e18",null).exports,h={props:{visible:Boolean,img:{type:String,default:""}},data:function(){return{back:{height:"",overflow:""}}},computed:{dialogVisible:function(){return this.visible?this.lockBody():this.unLockBody(),this.visible}},methods:{lockBody:function(){this.back.height=document.body.style.height,this.back.overflow=document.body.style.overflow,document.body.style.height="100%",document.body.style.overflow="hidden"},unLockBody:function(){"undefined"!=typeof window&&(document.body.style.height=this.back.height,document.body.style.overflow=this.back.overflow)},hide:function(){this.unLockBody(),this.$emit("update:visible",!1)}}},C=(n(277),{components:{Comment:v,BigImg:Object(d.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("transition",{attrs:{name:"fade"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogVisible,expression:"dialogVisible"}],staticClass:"dialog"},[n("transition",{attrs:{name:"slide-down"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.dialogVisible,expression:"dialogVisible"},{name:"click-outside",rawName:"v-click-outside",value:t.hide,expression:"hide"}],staticClass:"dialog-body"},[n("div",{staticClass:"dialog-content"},[t._t("default"),t._v(" "),t.img?n("img",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.hide,expression:"hide"}],staticClass:"close",attrs:{src:t.img,alt:""},on:{click:t.hide}}):t._e()],2),t._v(" "),n("div",{staticClass:"dialog-foot"},[t._t("foot")],2)])])],1)])}),[],!1,null,null,null).exports},data:function(){return{isBigImg:!1,img:""}},fetch:function(t){var e=t.store,n=t.params;return e.dispatch("getArticle",n.id)},head:function(){return{title:"".concat(this.article.title)}},computed:{article:function(){return this.$store.state.article.detail}},mounted:function(){this.tocInit(),this.initEvent()},methods:{initEvent:function(){for(var t=document.getElementsByClassName("markdown-body")[0].getElementsByTagName("img"),e=this,n=function(i){t[i].addEventListener("click",(function(n){n.stopPropagation(),e.isBigImg=!0,e.img=t[i].getAttribute("src")}))},i=0;i<t.length;i++)n(i)},tocInit:function(){var t="h1, h2, h3, h4",body=document.getElementsByClassName("markdown-body");body&&body[0].querySelectorAll(t).forEach((function(t){t.setAttribute("id",t.innerHTML)}));o.a.init({tocSelector:".markdown-toc",contentSelector:".markdown-body",headingSelector:t}),setTimeout((function(){document.getElementsByClassName("markdown-toc")[0].style.opacity=1}),500)}}}),f=(n(278),n(279),Object(d.a)(C,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"article"}},[n("h1",{staticClass:"article-title text-bold"},[t._v(t._s(t.article.title))]),t._v(" "),n("div",{staticClass:"article-info"},[t.article.category?n("p",{staticClass:"article-category"},[n("span",{staticClass:"icon-folder"}),t._v("\n      "+t._s(t.article.category.name)+"\n    ")]):t._e(),t._v(" "),n("p",{staticClass:"article-date"},[n("span",{staticClass:"icon-calendar"}),t._v("\n      "+t._s(t._f("time")(t.article.publishTime,"yyyy-MM-dd"))+"\n    ")]),t._v(" "),n("p",{staticClass:"article-date"},[n("span",{staticClass:"icon-eye"}),t._v(" "+t._s(t.article.hits)+"\n    ")]),t._v(" "),n("p",{staticClass:"article-date"},[n("span",{staticClass:"icon-bubble2"},[t._v(" "+t._s(t.article.commentCount)+" ")])])]),t._v(" "),n("div",{directives:[{name:"prism",rawName:"v-prism"}],staticClass:"markdown-body",domProps:{innerHTML:t._s(t.article.contentHtml)}}),t._v(" "),t.article.tags?n("div",{staticClass:"article-tags"},[n("label",{staticClass:"label-tags"},[t._v("Tags:")]),t._v(" "),t._l(t.article.tags,(function(e){return n("span",{key:e.id,staticClass:"article-tag"},[n("nuxt-link",{attrs:{to:{path:"/tag/"+e.name}}},[t._v("#"+t._s(e.name))])],1)}))],2):t._e(),t._v(" "),n("nav",{staticClass:"markdown-toc toc"}),t._v(" "),t.article.allowComment?n("comment",{attrs:{"article-id":t.article.id}}):t._e(),t._v(" "),n("big-img",{attrs:{visible:t.isBigImg,img:t.img},on:{"update:visible":function(e){t.isBigImg=e}}})],1)}),[],!1,null,"de479060",null));e.default=f.exports}}]);